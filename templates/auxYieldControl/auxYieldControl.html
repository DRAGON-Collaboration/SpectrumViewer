<link rel="stylesheet" href="auxYieldControl.css"/>

<template id='auxYieldControl'>
    <div id='componentTableWrapper' class='sectionWrapper'>
        <h4>Run Parameters</h4>

        <hr></hr>

        <h4>Components</h4>
        <table id='componentTable' class="table">
            <tr>
                <td>Label</td>
                <td>Lifetime</td>
                <td>Amplitude</td>
                <td>Efficiency</td>
                <td>Yield</td>
                <td class='center'>Delete</td>
            </tr>
        </table>

        <button id='new-component' class='btn btn-default'>Add New Component</button>

        <hr></hr>

        <h4>Histogram & Fitting Parameters</h4>
        <div class='sectionWrapper'>
            <div class='col-md-4'>
                <label>Histogram calibration: </label>
                <input id='calibration' type='number' value=1></input>
                <select id='calibrationUnit'>
                    <option value=1>ns</option>
                    <option value=1000>us</option>
                    <option value=1000000>ms</option>
                    <option value=1000000000>s</option>
                </select>
                <label>/bin</label>
            </div>
            <div class='col-md-8'>
                <label>Fit range (bins):</label>
                <label>Min: </label>
                <input type='number' id='decayMinBin' step='1'></input>
                <label>Max: </label>
                <input type='number' id='decayMaxBin' step='1'></input>
            </div>
        </div>

        <button id='fit-decay' class='btn btn-info top-gutter' onclick='fitDecay()'>Fit Decay Spectrum</button>
    </div>
</template>

<script>

    function auxYieldControl(wrapID){

        this.wrapID = wrapID;
        this.wrap = document.getElementById(wrapID);

        this.setup = function(){
            this.wrap.innerHTML =  Mustache.to_html(
                dataStore.templates.auxYieldControl, 
                {

                }
            );

            // set up custom listeners
            listener(this.wrapID, 'addPlotRow', this.refreshTable.bind(this));

            // plug in UI
            document.getElementById('new-component').onclick = this.newTableRow.bind(this);

            // start with one component
            this.newTableRow();

        }

        this.refreshTable = function(event){

            document.getElementById('decayMinBin').value = dataStore.viewers[dataStore.plots[0]].XaxisLimitMin;
            document.getElementById('decayMaxBin').value = dataStore.viewers[dataStore.plots[0]].XaxisLimitMax

        }

        this.newTableRow = function(event){
            // add a new component to the table

            var row = document.createElement('tr');

            row.innerHTML = Mustache.to_html(
                dataStore.templates.fitRow, 
                {
                    index: dataStore.componentIndex
                }
            );
            row.setAttribute('id', 'compenentRow'+dataStore.componentIndex);
            document.getElementById('componentTable').appendChild(row);

            // plug in delete button
            document.getElementById('delete' + dataStore.componentIndex).onclick = this.deleteRow.bind(this,dataStore.componentIndex);

            dataStore.componentIndex++;
        }

        this.deleteRow = function(index){
            // remove the indexed component row

            deleteNode('compenentRow'+index);
        }
    }

</script>